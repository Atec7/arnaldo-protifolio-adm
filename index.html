<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Portfólio</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Poppins',sans-serif;background:#0f0f0f;color:#fff;padding:20px;}
h1,h2{color:#FFD700;margin-bottom:15px;}
input,textarea,select{width:100%;padding:10px;margin:5px 0;border-radius:8px;border:none;background:#222;color:#fff;}
button{background:linear-gradient(45deg,#FFD700,#FFA500);color:#0f0f0f;border:none;padding:10px 15px;border-radius:12px;cursor:pointer;margin:5px;transition:.3s;font-weight:600;}
button:hover{transform:scale(1.05);}
.project-card{background:#1a1a1a;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 5px 15px rgba(0,0,0,0.5);}
.project-card h3{color:#FFD700;margin:0 0 5px 0;}
.project-card p{color:#ccc;margin:5px 0;}
.image-field{display:flex;margin-bottom:5px;}
.image-field input{flex:1;margin-right:5px;background:#333;color:#fff;}
.image-field button{flex:0;}
hr{border-color:#FFD700;margin:30px 0;}
</style>
</head>
<body>

<h1>Admin - Portfólio</h1>

<section id="add-project">
<h2>Adicionar / Editar Projeto</h2>
<form id="projectForm">
<label>Título</label>
<input type="text" id="title" required>

<label>Descrição</label>
<textarea id="description" rows="3" required></textarea>

<label>Categoria</label>
<select id="category" required>
  <option value="web">Web</option>
  <option value="data">Data & BI</option>
  <option value="adm">Administrativo</option>
</select>

<div id="imagesContainer">
  <label>Imagens</label>
</div>
<button type="button" onclick="addImageField()">+ Adicionar Imagem</button>
<br>
<button type="submit" id="saveBtn">Salvar Projeto</button>
</form>
</section>

<hr>

<section id="projects-list">
<h2>Projetos Cadastrados</h2>
<div id="projectsContainer"></div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
import { getDatabase, ref, set, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBp2g7BsZSlhES5jrLX9-bz7LGyGBWKcjI",
  authDomain: "portifolio-arnaldo.firebaseapp.com",
  databaseURL: "https://portifolio-arnaldo-default-rtdb.firebaseio.com/",
  projectId: "portifolio-arnaldo",
  storageBucket: "portifolio-arnaldo.firebasestorage.app",
  messagingSenderId: "349669431020",
  appId: "1:349669431020:web:b4644e22768fa9e4cdb7c9",
  measurementId: "G-WCY33Z6FXV"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Elements
const projectForm = document.getElementById("projectForm");
const titleInput = document.getElementById("title");
const descriptionInput = document.getElementById("description");
const categoryInput = document.getElementById("category");
const imagesContainer = document.getElementById("imagesContainer");
const projectsContainer = document.getElementById("projectsContainer");
const saveBtn = document.getElementById("saveBtn");

let editingProjectId = null;

// Adicionar campo de imagem
window.addImageField = function(value=""){
  const div = document.createElement("div");
  div.className = "image-field";
  div.innerHTML = `
    <input type="text" class="image-link" placeholder="Link Dropbox" value="${value}">
    <button type="button" onclick="removeImageField(this)">-</button>
  `;
  imagesContainer.appendChild(div);
}

// Remover campo de imagem
window.removeImageField = function(btn){ btn.parentElement.remove(); }

// Converter link Dropbox
function formatDropboxLink(url){
  if(!url) return "";
  if(url.includes("dropbox.com") && !url.includes("?dl=1")){
    if(url.includes("?dl=0")) url = url.replace("?dl=0","?dl=1");
    else url += "?dl=1";
  }
  return url;
}

// Salvar projeto
projectForm.addEventListener("submit",(e)=>{
  e.preventDefault();
  const title = titleInput.value.trim();
  const description = descriptionInput.value.trim();
  const category = categoryInput.value;
  const images = Array.from(document.querySelectorAll(".image-link"))
                      .map(input=>formatDropboxLink(input.value.trim()))
                      .filter(url=>url);
  if(images.length === 0){ alert("Adicione pelo menos uma imagem!"); return; }

  const projectData = { title, description, category, images };

  if(editingProjectId){
    update(ref(db,"projects/"+editingProjectId), projectData);
    editingProjectId = null;
    saveBtn.textContent = "Salvar Projeto";
  } else {
    const newProjRef = push(ref(db,"projects"));
    set(newProjRef, projectData);
  }

  projectForm.reset();
  imagesContainer.innerHTML = "";
  addImageField();
});

// Listar projetos
function listProjects(){
  onValue(ref(db,"projects"), snapshot=>{
    const data = snapshot.val() || {};
    projectsContainer.innerHTML = "";
    for(const id in data){
      const project = data[id];
      const card = document.createElement("div");
      card.className = "project-card";
      card.innerHTML = `
        <h3>${project.title}</h3>
        <p>${project.description}</p>
        <p><b>Categoria:</b> ${project.category}</p>
        <p><b>Imagens:</b> ${project.images.length}</p>
        <button onclick="editProject('${id}')">Editar</button>
        <button onclick="deleteProject('${id}')">Excluir</button>
      `;
      projectsContainer.appendChild(card);
    }
  });
}

// Editar projeto
window.editProject = function(id){
  const projectRef = ref(db,"projects/"+id);
  onValue(projectRef, snapshot=>{
    const project = snapshot.val();
    if(project){
      titleInput.value = project.title;
      descriptionInput.value = project.description;
      categoryInput.value = project.category;
      imagesContainer.innerHTML = "";
      project.images.forEach(url=>addImageField(url));
      editingProjectId = id;
      saveBtn.textContent = "Atualizar Projeto";
    }
  }, {once:true});
}

// Excluir projeto
window.deleteProject = function(id){
  if(confirm("Tem certeza que deseja excluir este projeto?")){
    remove(ref(db,"projects/"+id));
  }
}

// Inicializa com 1 campo de imagem
addImageField();
listProjects();

</script>
</body>
</html>
